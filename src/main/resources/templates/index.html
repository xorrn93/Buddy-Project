<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë‹¹ì‹ ì˜ ë™ë£Œ, ì˜ì›í•œ ì¹œêµ¬ buddy</title>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <link rel="stylesheet" href="/static/css/reset.css">
    <link rel="stylesheet" href="/static/css/home.css" />
    <link rel="stylesheet" href="/static/css/m-home.css" />
    <script src="/static/js/jQueryCheck.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gothic+A1&family=Nanum+Gothic&family=Noto+Sans+KR&display=swap" rel="stylesheet">
    <script src="/static/js/console.js"></script>
  </head>
  <body>
  <th:block th:if="${#strings.isEmpty(session.memberSeq)}">
    <div class="wrap">
      <div class="logo">
        <img src="/static/img/logo.png" alt="" />
      </div>
      <p class="slogan">ë‹¹ì‹ ì˜ ë™ë£Œ, ì˜ì›í•œ ì¹œêµ¬</p>
      <form action="/member/login" method="post" id="loginForm">
        <input type="text" name="memberId" id="id" class="loginId" placeholder="ì´ë©”ì¼"/>
        <input type="password" name="memberPw" id="pw" class="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸"/>
        <a href="" id="pwShow" class="apwShow">ğŸ‘€</a>
        <a href="" id="sessionEmaill" class="aLeft">ì´ë©”ì¼ ê¸°ì–µí•˜ê¸°</a>
        <a href="/member/toFindPW" id="findPw" class="aRight">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
        <button type="button" id="loginBtn" class="loginBtn">ë¡œê·¸ì¸</button>

        <!-- ë„¤ì´ë²„ ë¡œê·¸ì¸ / divë¡œ ì„¤ì •í•´ì•¼ ì‘ë™í•¨-->
        <div id="button_area"></div>
        <div id="naverIdLogin"></div>

        <!-- ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ -->
<!--        <button type="" id="kakao" class="snsLogin">-->
        <a href="javascript:kakaoLogin();" id="kakao">ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì¸</a>
<!--        </button>-->
        <div class=""style="clear: both"></div>


        <a href="/member/toSignUp" id="goSignup"
          >ì•„ì§ íšŒì›ì´ ì•„ë‹ˆì‹ ê°€ìš”? <strong>íšŒì›ê°€ì…</strong></a
        >
      </form>

    </div>
  </th:block>
  <th:block th:if="${not #strings.isEmpty(session.memberSeq)}">
    <!-- ë§ˆì´í˜ì´ì§€ -->
    <div class="wrap">
      <div class="logo">
        <img src="/static/img/logo.png" alt="" />
      </div>
      <p class="slogan">ë‹¹ì‹ ì˜ ë™ë£Œ, ì˜ì›í•œ ì¹œêµ¬</p>
<div class="contentWrap">
      <div id="profileBox" class="profileBox">
        <p class="title">profile</p>
        <div class="myProfile">
          <img th:src="${memberImg}" alt="" id="myImg" class="profileImg" />
          <div class="info">
            <!-- ì„¸ì…˜ì— ë¿Œë ¤ì§„ ê°’ìœ¼ë¡œ í•´ê²°í•˜ê¸° -->
            <h1 id="myName" class="name" th:text="${session.memberName}">userName</h1>
            <p id="myEmail" class="email" th:text="${session.memberLogtype}">userEmail</p>
          </div>
          <button type="button" id="myprofile" class="floatBtn">
            ê³„ì •ì„¤ì •
          </button>
          <button type="button" id="logout" class="floatBtn">
            ë¡œê·¸ì•„ì›ƒ
          </button>
        </div>
        <th:block th:if="${#strings.equals(session.memberLogtype,'admin')}">
          <button type="button" id="adminPage" class="floatBtn">
            ê´€ë¦¬ìí˜ì´ì§€
          </button>
        </th:block>
      </div>
      <div class="temListBox" th:if="${teamDtoList!=null}">
        <p class="title">íŒ€ ë¦¬ìŠ¤íŠ¸ <span id="teamCount">[[${teamCount}]]</span><span> / 5</span></p>
        <div class="teamProfile" th:each="teamDtoList : ${teamDtoList}">
          <img src="/static/img/teamProfile2.png" alt="" id="teamImg" class="profileImg" />
          <div class="info">
            <h1 id="teamName" class="name" th:text="${teamDtoList.teamName}"></h1>
          </div>
          <form action="/team/goTeam" method="post" style="width: 0px;" >
            <input type="hidden" th:value="${teamDtoList.teamSeq}" th:name="teamSeq">
            <button id="goTeam" class="floatBtn">
              íŒ€ìœ¼ë¡œ ê°€ê¸°
            </button>
          </form>
          <form action="/team/goTeamSetting" method="post" style="width: 0px;">
            <input type="hidden" th:value="${teamDtoList.teamSeq}" name="teamSeq">
          <button id="managementTeam" class="floatBtn" th:if="${teamDtoList.teamOwnerSeq==session.memberSeq || SubManagerMember>0}">
            íŒ€ ê´€ë¦¬
          </button>
          </form>
        </div>
        <button type="button" id="insertInviteCode">ì´ˆëŒ€ì½”ë“œì…ë ¥</button>

      </div>
</div>

        <div class="addTeam" id="addTeam">
            âœ…íŒ€ ìƒì„± í•˜ê¸°

        </div>
      </div>
    </div>
  </th:block>

    <!-- ë¡œê·¸ì¸ í¼ -->
    <script>

      function getLogin(){
        let id = $('#id').val();
        let pw = $('#pw').val();

        if(id == "" || pw == ""){
          alert("ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
        }else{
          $("#loginForm").submit();
        }
      }

      $(function(){
        let loginBtn = $("#loginBtn");

        loginBtn.on("click",function(){
          getLogin();
        });

        $("#pw").on("keydown",function(e){
            if (e.keyCode == 13) {
              getLogin();
            }
        });
      })
      // ë¹„ë°€ë²ˆí˜¸ ë³´ì´ê¸° ì¶”ê°€
      $('#pwShow').mouseover(function (){
        $('#pw').prop("type","text");
      })

      $('#pwShow').mouseleave(function (){
        $('#pw').prop("type","password");
      })


    </script>

    <!-- ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ script -->
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <script type="text/javascript">


      window.Kakao.init('7916c939205e8db616216bc236bc79c3');

      function kakaoLogin() {
        window.Kakao.Auth.login({
          scope: 'profile_nickname, account_email', //ë™ì˜í•­ëª© í˜ì´ì§€ì— ìˆëŠ” ê°œì¸ì •ë³´ ë³´í˜¸ í…Œì´ë¸”ì˜ í™œì„±í™”ëœ IDê°’ì„ ë„£ìŠµë‹ˆë‹¤.
          success: function(response) {
            console.log(response) // ë¡œê·¸ì¸ ì„±ê³µí•˜ë©´ ë°›ì•„ì˜¤ëŠ” ë°ì´í„°
            window.Kakao.API.request({ // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
              url: '/v2/user/me',
              success: (res) => {
                console.log(res);
                const kakao_account = res.kakao_account;
                const kakao_properties = res.properties;

                let id = kakao_account.email;
                let name = kakao_properties.nickname;

                location.href = "/member/kakaoLogin?memberId="+id+"&memberName="+name+"&memberLogtype=kakao";
              }
            });
          },
          fail: function(error) {
            console.log(error);
          }
        });
      }

      // ì¹´ì¹´ì˜¤ íƒˆí‡´
      function secession() {
        Kakao.API.request({
          url: '/v1/user/unlink',
          success: function(response) {
            //callback("íƒˆí‡´ ì™„ë£Œ"); //ì—°ê²°ëŠê¸°(íƒˆí‡´)ì„±ê³µì‹œ ì„œë²„ì—ì„œ ì²˜ë¦¬í•  í•¨ìˆ˜
            window.location.href='/'
          },
          fail: function(error) {
            console.log('íƒˆí‡´ ë¯¸ì™„ë£Œ');
            console.log(error);
          },
        });
      };
    </script>

    <!-- ë„¤ì´ë²„ ë¡œê·¸ì¸ script -->
    <script src="https://static.nid.naver.com/js/naveridlogin_js_sdk_2.0.2.js" charset="utf-8"></script>
    <script type="text/javascript">

      const naverLogin = new naver.LoginWithNaverId(
              {
                clientId: "MPvUbOX30trYmVJWI5qi",
                callbackUrl: "http://43.201.133//",
                loginButton: {color: "green", type: 2, height: 40}
              }
      );

      naverLogin.init();
      naverLogin.getLoginStatus(function (status) {
        if (status) {
          const name = naverLogin.user.getName();
          const email = naverLogin.user.getEmail();
          let phone = naverLogin.user.getMobile();

          if(name===null||name===undefined ){
            alert("ì •ë³´ì œê³µì„ ë™ì˜í•´ì£¼ì„¸ìš”.");
            naverLogin.reprompt();
            return ;
          }else{
            setLoginStatus();
            console.log(name);
            console.log(email);
            console.log(phone);
            location.href="/member/naverLogin?memberId="+ email + "&memberName="+ name + "&memberPhone=" + phone + "&memberLogtype=naver";
          }
        }
      });

      function setLoginStatus(){
        const message_area=document.getElementById('message');

        const name = naverLogin.user.getName();
        const email = naverLogin.user.getEmail();
        let phone = naverLogin.user.getMobile();

        phone = phone.replace(/\-/g,''); // ì „í™”ë²ˆí˜¸ '-' ì œê±° (ì •ê·œí‘œí˜„ì‹ ì‚¬ìš©)

        console.log(naverLogin.user.getName());
      }

    </script>
    <!-- ë¡œê·¸ì•„ì›ƒ (ì¼ë°˜ / kakao / naver) -->
    <script type="text/javascript">
      $("#logout").on("click",function(){
        let loginType = $("#loginType").val();
        if(confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
          if(loginType == "normal"){
            location.href="/member/logout";
          }else if(loginType == "kakao"){
            kakaoLogout();
            function kakaoLogout() {
              if (!Kakao.Auth.getAccessToken()) {
                return;
              }
              Kakao.Auth.logout(function(response) {
                alert(response +' logout');
                window.location.href="/member/logout";
              });
            };
          }else{
            naverLogin.logout();
            location.href="/member/logout";
            //location.href = "http://nid.naver.com/nidlogin.logout";//logout()ì´ ì‘ë™ë˜ì§€ ì•Šìœ¼ë©´ ì´ê±° ì‚¬ìš©
          }
        }
      });

      $('#myprofile').on("click",function (){
          location.href="/member/goMyProfile";
      });
    </script>

    <!-- ê´€ë¦¬ì í˜ì´ì§€ë¡œ ì´ë™ -->
  <script>
    $("#adminPage").on("click",function(){
      location.href = "/member/toAdminMember";
    });
  </script>

  <script>
    //íŒ€ ìƒì„± ì´ë²¤íŠ¸
    $("#addTeam").click(function (){
      if ($("#teamCount").text()>=5) {
        alert("5íŒ€ ì´ìƒ ì°¸ì—¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      } else {
        location.href = "/team/add";
      }
    })

  </script>

  <!-- ì´ˆëŒ€ì½”ë“œ ì…ë ¥ -->
  <script>
    let teamSeq = $("#teamCount").text();
    $('#insertInviteCode').on('click',function(){
      if(teamSeq >= 5){
        alert("ìµœëŒ€ 5íŒ€ë§Œ ì°¸ì—¬ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
      }else{
        location.href = "/invite/goEnterTeam";
      }
    })
    function invite(){
      let invite = window.open("/invite/goEnterTeam","íŒ€ì› ì´ˆëŒ€","width = 500, height = 300, top = 50%, left = 50%, location = no, toolbars = no, status = no, scrollbars = no");
      invite.onbeforeunload = function (){
        window.location.reload();
      }
    }
  </script>

  </body>
</html>
